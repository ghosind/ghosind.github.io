var cells=new Array();var score=0;var highest_score=0;var empty_cells=new Array();var last_move_location=-1;function init(){new_game();document.onkeydown=function(event){var code=event.keycode||event.which||event.char;move(code)}}
function new_game(){empty_cells=new Array();for(var i=0;i<4;i++){cells[i]=new Array();for(var j=0;j<4;j++){cells[i][j]=0;empty_cells.push(i*4+j)}}
score=0;generate_new_number();generate_new_number();paint()}
function paint(){for(var i=0;i<4;i++){for(var j=0;j<4;j++){var cell=document.getElementById("r"+(i+1)+"c"+(j+1));if(cells[i][j]!=0){cell.innerText=cells[i][j]}
else{cell.innerText=""}}}
var score_lable=document.getElementById("score");score_lable.innerText=score;var highest_lable=document.getElementById("highest");highest_lable.innerText=highest_score}
function generate_new_number(){if(empty_cells.length==0){return!1}
var index=Math.floor(Math.random()*empty_cells.length);if(last_move_location!=-1&&empty_cells[index]==last_move_location){index=Math.floor(Math.random()*empty_cells.length)}
var is_four=Math.floor(Math.random()*10)==0?!0:!1;var row=Math.floor(empty_cells[index]/4);var column=empty_cells[index]%4;cells[row][column]=is_four==!0?4:2;empty_cells.splice(index,1)}
function move(keycode){switch(keycode){case 37:case 38:case 39:case 40:if(!merge(keycode)){return}
paint();break;default:return}
check_empty();generate_new_number();paint()}
function merge(direction){var moved=!1;var start=direction<39?0:3;var step=direction<39?1:-1;last_move_location=-1;for(var i=start;i<4&&i>-1;i+=step){for(var j=start;j<4&&j>-1;j+=step){if((direction==38||direction==40)&&cells[j][i]!=0){var k=j+step;for(;k<4&&k>-1&&cells[k][i]==0;k+=step){}
if(k<4&&k>-1&&k!=j&&cells[k][i]==cells[j][i]){cells[j][i]*=2;cells[k][i]=0;score+=cells[j][i];moved=!0;last_move_location=k*4+i}
var l=j-step;for(;l<4&&l>-1&&cells[l][i]==0;l-=step){}
if(l+step!=j&&cells[l+step][i]==0){cells[l+step][i]=cells[j][i];cells[j][i]=0;moved=!0;last_move_location=j*4+i}}else if((direction==37||direction==39)&&cells[i][j]!=0){var k=j+step;for(;k<4&&k>-1&&cells[i][k]==0;k+=step){}
if(k<4&&k>-1&&k!=j&&cells[i][k]==cells[i][j]){cells[i][j]*=2;cells[i][k]=0;score+=cells[i][j];moved=!0;last_move_location=i*4+k}
var l=j-step;for(;l<4&&l>-1&&cells[i][l]==0;l-=step){}
if(l+step!=j&&cells[i][l+step]==0){cells[i][l+step]=cells[i][j];cells[i][j]=0;moved=!0;last_move_location=i*4+j}}}}
highest_score=score>highest_score?score:highest_score;return moved}
function check_empty(){empty_cells=new Array();for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(cells[i][j]==0){empty_cells.push(i*4+j)}}}}